### XSS攻击
Xss全称为Cross Site Script,就是跨站点脚本攻击，黑客通过恶意篡改前端代码，在里面注入html+JavaScript脚本，当用户点击时，恶意脚本在浏览器中运行就会控制用户浏览器
* 第一种Xss攻击叫做反射型攻击，主要是引诱用户点击url链接，在url链接中嵌入恶意脚本。url链接的展现形式可能是图片，flash动图，小视频。一段恶意的js脚本几乎可以无恶不作，可以通过窃取cookie
来伪造用户登录session状态
* 第二种XSS攻击叫做持久型攻击，黑客可以通过发表评论的形式将恶意脚本持久化到服务端，当其他用户浏览这条评论时，评论内容中的恶意js脚本就会返回到用户浏览器中运行。

防止XSS的手段：
消毒机制:对用户输入做转义，使恶意脚本失效
```
<html>   ->  &lthtml&gt  ,转义后的内容是无法在浏览器中运行的
<html><script>//包含恶意脚本</script></html>, 这样的恶意脚本转义后即使被用户看到也不会在浏览器中运行了
```

* 设置HttpOnly:
在用户浏览器中存放cookie时，可以设置为HttpOnly属性，设置了httpOnly属性的cookie无法被js脚本读取，这样恶意js脚本也就无法窃取cookie了

### SQL注入
系统存在漏洞，当执行sql时把包含sql语法的用户输入部分拼接为 sql去执行。一般使用sql注入攻击不是特别容易，需要知道数据库表结构，而获取数据库表结构的方式有下面几种:
1. 使用开源软件，如开源博客系统、论坛系统，这种情况比较少见
2. 错误回显。web系统报错时通过异常堆栈信息将包含错误sql暴露表结构
3. 根据请求参数名称推测数据库表结构，这个一般不现实  
防止sql注入方式:
1. 保护表结构不被暴露
2. 关闭web服务器的错误回显，只显示http错误码
3. 使用预编译的方式执行sql
最佳实践: 平时开发系统要关闭web系统错误回显，使用mybatis的预编译，不能直接拼接sql语句

### CSRF
跨站点请求伪造，是一种攻击方式。CSRF和XSS的关系是黑客利用xss来窃取到用户cookie后，利用用户cookie然后通过postman发起跨站点请求来伪装成真实用户请求。

* 防御csrf的4种方式:
>1. 防止cookie被窃取:将网站cookie设置为HttpOnly属性，防止被js脚本读取cookie，无法窃取cookie就无法伪造用户请求了。  
>2. 随机token:每次返回页面时，在页面隐藏元素里生成一个随机token，同时存入redis，当页面发送请求时附加随机token，验证通过才能执行请求，这样用postman伪造请求会因不知道随机token而失败
>3. 验证码:页面提交用验证码或滑动拼图来过滤，避免黑客通过postman直接伪造请求
>4. Referer请求头:http请求里有一个referer请求头，带有请求来源，通过对请求来源做校验，如果不是从本系统页面过来的直接拒绝。

### 如果系统允许用户上传文件，可能会遭到什么样的黑客攻击？
黑客可以将可执行脚本、病毒、木马文件后缀改成.jpg、.txt之类的然后来上传，上传成功后可以利用病毒脚本来黑掉服务器，然后干各种事比如连接数据库。
* 解决方案:
>1. 对上传文件类型做限制。限制文件类型不能简单根据后缀判断而是根据文件二进制开头的几个字节代表的magicNumber来判断文件类型。也就是通过读取文件的二进制流开头几个字节的方式来提取魔数，根据魔数值判断文件类型
>2. 对文件大小做限制，不允许用户上传大文件
>3. 对上传的文件重命名
>4. 对文件进行压缩，这样可以破坏原来文件结构(imagemagick开源包方便对文件压缩)

### Dos 和 DDos
* Dos攻击是一对一的。黑客用一台高性能服务器发送大量请求到一台业务系统服务器，假如业务系统每秒能抗5000请求，黑客的机器每秒发送5000请求就可以使业务系统宕机，当用每秒10000请求攻击时系统机器甚至直接挂掉
* DDos(distributed denial of service)，分布式拒绝服务攻击。最可怕的黑客攻击，可以瞬间用大量请求压垮系统。DDos就是黑客控制大量机器一起发送请求到攻击目标机器，DDoS
是一个攻击概念，通过发动洪水攻击搞垮对方的服务器，而具体操作手段包括三种:SYN Flood、DNS query Flood、Http Flood

### 基于SYN flood模式的DDoS攻击，背后的原理是什么？
TCP的三次握手过程:
>1. 客户端发送一个带有客户端端口号和TCP连接初始序列号的SYN请求给服务器
>2. 服务器收到SYN后，回复一个SYN+ACK,表示已收到请求，并将TCP序列号加1
>3. 客户端收到服务器的SYN+ACK后，给服务器返回ACK，并将TCP序列号加1，连接建立完毕，可以通信
* 攻击过程: 当服务器没有收到第三步的ACK，会重新发送SYN+ACK给客户端，同时连接处于SYN_RECV状态，此时服务端会将客户端放入等待列表，每隔30秒遍历一次等待列表，重新给等待列表中的客户端发送SYN+ACK，重试3-5
次。服务器返回SYN+ACK给客户端时，会为客户端预留一部分资源，重试期间都保留，等待跟客户端建立连接;黑客通过伪造大量不同ip地址去发送SYN请求给一台服务器请求建立TCP连接，然后将这些连接都卡在第二步的服务器返回SYN+ACK，而黑客是不会执行第三步返回ACK的，所以导致服务器为黑客建立了大量的半连接放在等待列表里，占用了大量资源并不断重试，一旦服务器资源耗尽，正常请求无法建立TCP连接导致请求失败。HTTP底层是基于TCP实现的，一旦无法建立TCP连接，那么这台服务器就无法接受任何HTTP请求了

### 基于DNS query Flood的DDOS攻击原理是什么？
* 黑客通过伪造大量不存在的域名去请求DNS服务器对其进行解析，最近的DNS服务器找不到就会找上级DNS服务器，一直找到根服务器，这样会导致DNS服务器资源耗尽，无法对正常浏览请求中的域名进行解析

### 基于Http Flood(CC攻击)的DDoS攻击原理是什么？
* 在互联网上找到大量http代理，通过代理服务器给目标服务器发送大量Http请求，导致目标服务器直接挂掉

### 在分布式架构中，Zuul网关是如何防止网络攻击的？
主流网络攻击方式主要有XSS、CRSF、SQL注入、DDoS
* 对于XSS和CSRF方式的攻击，核心解决方法就是设置cookie的HttpOnly属性，防止js脚本窃取cookie。并根据referer请求头对请求过滤，防止在非白名单页面请求
* 对于SQL注入，过滤恶意参数
* 对于DDos攻击，主要是限流，或者引入云安全厂商产品  

在Zuul中加过滤器，过滤特殊请求脚本，也可以做到根据referer请求头过滤，对请求的随机token进行校验，也可以对请求参数校验(如果参数中包含SQL说明要注入攻击，可以全部过滤)，对ip地址做基于redis的访问计数(如一个ip地址每秒连续访问5次则禁止访问)



















































































