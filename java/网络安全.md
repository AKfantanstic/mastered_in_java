### XSS攻击
Xss全称为Cross Site script,就是跨站点脚本攻击，黑客通过恶意篡改前端代码，在里面注入html+JavaScript脚本，当用户点击时，恶意脚本在浏览器中运行就会控制用户浏览器
* 第一种Xss攻击叫做反射型攻击，主要是引诱用户点击url链接，在url链接中嵌入恶意脚本。url链接的展现形式可能是图片，flash动图，小视频。一段恶意的js脚本几乎可以无恶不作，可以通过窃取cookie
来伪造用户登录session状态
* 第二种XSS攻击叫做持久型攻击，黑客可以通过发表评论的形式将恶意脚本持久化到服务端，当其他用户浏览这条评论时，评论内容中的恶意js脚本就会返回到用户浏览器中运行。

防止XSS的手段：
消毒机制:对用户输入做转义，使恶意脚本失效
```
<html>   ->  &lthtml&gt  ,转义后的内容是无法在浏览器中运行的
<html><script>//包含恶意脚本</script></html>, 这样的恶意脚本转义后即使被用户看到也不会在浏览器中运行了
```

* 设置HttpOnly:
在用户浏览器中存放cookie时，可以设置为HttpOnly属性，设置了httponly属性的cookie无法被js脚本读取，这样恶意js脚本也就无法窃取cookie了

### SQL注入
系统存在漏洞，当执行sql时把包含sql语法的用户输入部分拼接为 sql去执行。一般使用sql注入攻击不是特别容易，需要知道数据库表结构，而获取数据库表结构的方式有下面几种:
1. 使用开源软件，如开源博客系统、论坛系统，这种情况比较少见
2. 错误回显。web系统报错时通过异常堆栈信息将包含错误sql暴露表结构
3. 根据请求参数名称推测数据库表结构，这个一般不现实  
防止sql注入方式:
1. 保护表结构不被暴露
2. 关闭web服务器的错误回显，只显示http错误码
3. 使用预编译的方式执行sql
最佳实践: 平时开发系统要关闭web系统错误回显，使用mybatis的预编译，不能直接拼接sql语句

### CSRF
跨站点请求伪造，是一种攻击方式。CSRF和XSS的关系是黑客利用xss来窃取到用户cookie后，利用用户cookie然后通过postman发起跨站点请求来伪装成真实用户请求。

* 防御csrf的4种方式:
>1. 防止cookie被窃取:将网站cookie设置为HttpOnly属性，防止被js脚本读取cookie，无法窃取cookie就无法伪造用户请求了。  
>2. 随机token:每次返回页面时，在页面隐藏元素里生成一个随机token，同时存入redis，当页面发送请求时附加随机token，验证通过才能执行请求，这样用postman伪造请求会因不知道随机token而失败
>3. 验证码:页面提交用验证码或滑动拼图来过滤，避免黑客通过postman直接伪造请求
>4. Referer请求头:http请求里有一个referer请求头，带有请求来源，通过对请求来源做校验，如果不是从本系统页面过来的直接拒绝。

### 如果系统允许用户上传文件，可能会遭到什么样的黑客攻击？
黑客可以将可执行脚本、病毒、木马文件后缀改成.jpg、.txt之类的然后来上传，上传成功后可以利用病毒脚本来黑掉服务器，然后干各种事比如连接数据库。
* 解决方案:
>1. 对上传文件类型做限制。限制文件类型不能简单根据后缀判断而是根据文件二进制开头的几个字节代表的magicNumber来判断文件类型。也就是通过读取文件的二进制流开头几个字节的方式来提取魔数，根据魔数值判断文件类型
>2. 对文件大小做限制，不允许用户上传大文件
>3. 对上传的文件重命名
>4. 对文件进行压缩，这样可以破坏原来文件结构(imagemagick开源包方便对文件压缩)